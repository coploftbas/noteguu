<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../../../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../../../bower_components/polymerfire/firebase-query.html">

<link rel="import" href="../../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">


<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../../bower_components/paper-fab/paper-fab.html">

<link rel="import" href="input-food.html">
<link rel="import" href="food-item.html">


<dom-module id="page-profile">
    <style is="custom-style">
    .add {
        position:fixed;
        right:0;
        bottom:0;
        padding:20px;
    }

    </style>
    <template> 

        <firebase-document
            id="document"
            app-name="food"
            path="{{pathData}}"
            data="{{slotData}}">
        </firebase-document>

        <firebase-query
            app-name="food"
            path="/food"
            data="{{dataFood}}"
        >
        </firebase-query>

        {{displayName}}<br>
        
        <input-food on-add="addFood"></input-food>

        <template is="dom-repeat" items="{{dataFood}}">
                <food-item item="[[item]]" on-delete-food="deleteFood"></food-item>
        </template>
        <div class="add">
            <paper-fab icon="add" title="heart" on-tap="openAdd"></paper-fab>
        </div>

        <paper-dialog id="modal" modal>
            <p>จะเอาไว้ตรงไหนดีนร้า เอาไว้ตรงไหนดีนร้า ไว้ตรงไหนดีนร้า เอาไว้ตรงไหนดีนร้า</p>
            <div class="buttons">
                <paper-button dialog-confirm autofocus>Tap me to close</paper-button>
            </div>
        </paper-dialog>
    </template>
    <script>
        Polymer({
            is:'page-profile',
            properties:{
                dataFood:{
                    type:Array,
                    observer:'_dataFoodChanged'
                },
                user:{
                    type:Object,
                    observer:'_userChanged'
                }
            },
            observers:['_selectedChanged(selected)'],
            _selectedChanged:function(val){
                if(val == this.getAttribute('name')){
                    this.fire('change-title','Profile');
                }
            },
            addFood:function(e){
                var data = e.detail.data;
                var length = e.detail.data.list.length;
                data.list.splice(length-1,1);
                
                this.slotData = data;
                this.$.document.save('/food').then(null);
            },
            deleteFood:function(e){
                console.log(e.detail);
                this.pathData = '/food/'+e.detail.$key;
                this.$.document.destroy();
                this.pathData = null;
            },
            _userChanged:function(user){
                //console.log(user);
                if(user!=null){
                    this.displayName=user.displayName;
                }else{
                    this.displayName = "";
                }
            },
            _dataFoodChanged:function(){
                console.log(this.dataFood);
            },
            _itemsChanged:function(){
                console.log(this.items);
            },
            checkItem:function(item){
                console.log(item);
            },
            openAdd:function(){
                this.$.modal.open()
            }
        });
    </script>
</dom-module>