<link rel="import" href="../../../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">

<link rel="import" href="../../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../../bower_components/iron-scroll-threshold/iron-scroll-threshold.html">
<link rel="import" href="components/note-item.html">

<dom-module id="page-note">
    <template>
        <style>
            paper-textarea {
                margin:auto;
            }

            paper-button{
                background-color: var(--paper-green-500);
                color: white;
                height: 30px;
                float: right;
            }

            .container{
                
                margin:auto;
                width:50%;
            }

            .repeat{
                margin-top:50px;
            }

            @media  (max-width: 1200px) {
                .container{
                    width:70%;
                }
            }

            @media  (max-width: 600px) {
                .container{
                    width:90%;
                }
            }

        </style>

        <firebase-document 
            id="document" 
            app-name="noteguu" 
            path="{{pathData}}" 
            data="{{slotData}}">
        </firebase-document>
        <firebase-query
            app-name="noteguu"
            path="{{_getData(noteName)}}"
            data="{{dataNote}}"
            order-by-child="timestamp"
        >
        </firebase-query>

        <!--<div style="position:fixed">[[lowerTriggered]]</div>-->

        <div class="container">
            <paper-textarea label="Note" value="{{textarea}}"></paper-textarea>
            <paper-button raised on-tap="addNote" disabled$="[[isTextareaNull]]">ADD</paper-button>
            <div class="repeat">
                <iron-list items="[[dataNote]]" as="item">
                    <template>
                        <div>
                            <note-item item="[[item]]"></note-item>
                        </div>
                    </template>
                </iron-list>
                
            </div>
        </div>
        
        <iron-scroll-threshold 
            id="scrollTheshold"
            lower-threshold="500"
            on-lower-threshold="_loadMoreData"
            lower-triggered="{{lowerTriggered}}"
            scroll-target="html">
        </iron-scroll-threshold>
    </template>


    <script>
        Polymer({
            is:'page-note',
            observers:['_isNull(textarea)'],
            ready:function(){
                this.isTextareaNull = true;
            },
            _getData:function(noteName){
                console.log(noteName);
                return '/notes/'+noteName+'/data'
            },
            addNote:function(e){
                //console.log(firebase.database.ServerValue.TIMESTAMP);
                var d = new Date();
                var n = d.getTime();

                this.slotData = {text:this.textarea,timestamp:-Math.abs(n)};
                this.$.document.save('/notes/'+this.noteName+'/data').then(function(){
                    this.textarea = "";
                    this.$.document.reset();
                }.bind(this));
                
            },
            _isNull:function(textarea){
                this.isTextareaNull = !(textarea!="" && typeof textarea != "undefined")
            },
            _reverseArr:function(arr){
                console.log(arr.reverse());
                return arr.reverse();
            },
            _loadMoreData:function() {
                this.$.scrollTheshold.clearTriggers();
                console.log('ss');
            }
        });
    </script>
</dom-module>